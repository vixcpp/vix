@PACKAGE_INIT@

include(CMakeFindDependencyMacro)

# ---- deps that exported targets may reference ----
find_dependency(Threads REQUIRED)
find_dependency(fmt CONFIG REQUIRED)
find_dependency(spdlog CONFIG REQUIRED)

if (@VIX_WITH_OPENSSL@)
  find_dependency(OpenSSL REQUIRED)
endif()

if (@VIX_WITH_JSON@)
  find_dependency(nlohmann_json CONFIG REQUIRED)
endif()

if (@VIX_WITH_SQLITE@)
  find_dependency(SQLite3 REQUIRED)

  if (TARGET SQLite::SQLite3)
  elseif (TARGET SQLite3::SQLite3)
    add_library(SQLite::SQLite3 ALIAS SQLite3::SQLite3)
  elseif (TARGET sqlite3)
    add_library(SQLite::SQLite3 ALIAS sqlite3)
  endif()

  if (NOT TARGET SQLite::SQLite3)
    message(FATAL_ERROR "SQLite requested but no usable SQLite target was found.")
  endif()
endif()

if (@VIX_WITH_ZLIB@)
  find_dependency(ZLIB QUIET)
  if (ZLIB_FOUND AND NOT TARGET ZLIB::ZLIB)
    add_library(ZLIB::ZLIB INTERFACE IMPORTED)
    target_include_directories(ZLIB::ZLIB INTERFACE "${ZLIB_INCLUDE_DIRS}")
    target_link_libraries(ZLIB::ZLIB INTERFACE "${ZLIB_LIBRARIES}")
  endif()
  if (NOT TARGET ZLIB::ZLIB)
    message(FATAL_ERROR "Vix built with gzip support but ZLIB::ZLIB is unavailable.")
  endif()
endif()

# ---- MySQL (MUST be resolved BEFORE loading exported targets, if required) ----
set(VIX_DB_WITH_MYSQL @VIX_DB_WITH_MYSQL@)
if (VIX_DB_WITH_MYSQL)
  find_package(MySQLCppConn CONFIG REQUIRED)
  if (NOT TARGET MySQLCppConn::MySQLCppConn)
    message(FATAL_ERROR "Vix was built with MySQL support but MySQLCppConn::MySQLCppConn was not found.")
  endif()
endif()

# ---- load exported targets ----
include("${CMAKE_CURRENT_LIST_DIR}/VixTargets.cmake")

# ---- informational flags ----
set(VIX_HAS_ORM @VIX_HAS_ORM@)
if (VIX_HAS_ORM AND NOT TARGET vix::orm)
  set(VIX_HAS_ORM OFF)
endif()

set(VIX_HAS_CACHE @VIX_HAS_CACHE@)
if (VIX_HAS_CACHE AND NOT TARGET vix::cache)
  set(VIX_HAS_CACHE OFF)
endif()

set(VIX_WITH_CACHE @VIX_WITH_CACHE@)

set(VIX_HAS_P2P @VIX_HAS_P2P@)
if (VIX_HAS_P2P AND NOT TARGET vix::p2p)
  set(VIX_HAS_P2P OFF)
endif()

set(VIX_WITH_P2P @VIX_WITH_P2P@)
